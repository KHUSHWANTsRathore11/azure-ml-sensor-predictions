# Prod Environment - Reference Documentation

⚠️ **This file is reference documentation only - not loaded by pipelines**

See `docs/VARIABLE_GROUPS_REFERENCE.md` for complete setup instructions.

---

## Variable Groups

Configure these in **Azure DevOps → Pipelines → Library**:

### mlops-prod-variables

Azure ML Prod workspace connection:

```yaml
azureServiceConnection: "Azure-MLOps-Prod"
subscriptionId: "12345678-1234-1234-1234-123456789012"
resourceGroup: "mlops-prod-rg"
workspaceName: "mlops-prod-workspace"
location: "eastus"
```

### mlops-registry-variables

Azure ML Registry connection (shared across environments):

```yaml
registryName: "mlops-central-registry"
registryResourceGroup: "mlops-registry-rg"

# Model propagation settings (exponential backoff)
registryPropagationMaxWaitSeconds: 120
registryPropagationInitialDelaySeconds: 2
registryPropagationMaxDelaySeconds: 30
```

---

## Environment Details

**Purpose:** Production model serving

**Branch:** `main`

**Pipelines:**
- `prod-deployment-pipeline.yml` - Deploy models from registry

**Approval Environment:**
- `prod-deployment` - Approvers: Senior engineers + platform lead

**Note:** Prod environment does NOT train models - only deploys from Registry

---

## Azure ML Workspace Settings

**Compute:**
- Scoring: `Standard_DS4_v2`, 2-8 nodes (2 warm for HA)

**Deployment:**
- Auto-deploy: No (never auto-deploy to prod)
- Approval required: Yes (2 approvers)
- Blue-green deployment: Yes
- Traffic ramp: 0% → 10% → 25% → 50% → 100%

**Monitoring:**
- Log level: WARNING (errors only)
- Alerts: Enabled (PagerDuty + email + Slack)
- Application Insights: Enabled (10% sampling)

**Validation Thresholds (strictest):**
```yaml
min_accuracy: 0.85
max_mae: 5.0
max_rmse: 7.0
min_r2_score: 0.80
min_precision: 0.85
min_recall: 0.80
max_false_positive_rate: 0.10
```

**Alert Thresholds (strict):**
```yaml
model_drift: 0.10
data_drift: 0.15
prediction_latency_ms: 500
error_rate_percent: 2
endpoint_availability_percent: 99.5
```

**Auto-Rollback:**
- Enabled: Yes
- Error threshold: 5%
- Latency threshold: 2000ms

**Retention:**
- Models: 365 days (1 year)
- Logs: 90 days
- Datasets: 730 days (2 years)
- Predictions: 180 days

**Backup:**
- Frequency: Daily
- Retention: 30 days
- Geo-redundant: Yes

**Security:**
- VNet: Enabled
- Private endpoints: Yes
- Managed identity: Yes
- Key vault: `mlops-prod-keyvault`

---

## Tags

```yaml
environment: "prod"
cost_center: "ml-production"
owner: "ml-platform-team"
criticality: "high"
compliance: "required"
auto_shutdown: "disabled"
```
